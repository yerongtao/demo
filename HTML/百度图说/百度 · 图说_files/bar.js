define("echarts/chart/bar",["require","../component/base","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(require){function e(e,n,r,o,a){t.call(this,e,n,r,o,a),i.call(this),this.refresh(o)}var t=require("../component/base"),i=require("./base"),n=require("zrender/shape/Rectangle");require("../component/axis"),require("../component/grid"),require("../component/dataZoom");var r=require("../config"),o=require("../util/ecData"),a=require("zrender/tool/util"),s=require("zrender/tool/color");return e.prototype={type:r.CHART_TYPE_BAR,_buildShape:function(){this._bulidPosition()},_buildNormal:function(e,t,i,r,o){for(var a,s,l,h,c,d,p,u,f,m,g,y,V=this.series,U=i[0][0],b=V[U],_=b.xAxisIndex,x=b.yAxisIndex,v="horizontal"==o?this.component.xAxis.getAxis(_):this.component.yAxis.getAxis(x),k=this._mapSize(v,i),L=k.gap,w=k.barGap,S=k.barWidthMap,W=k.barMaxWidthMap,I=k.barWidth,C=k.barMinHeightMap,X=k.interval,T=0,K=t;K>T&&null!=v.getNameByIndex(T);T++){"horizontal"==o?h=v.getCoordByIndex(T)-L/2:c=v.getCoordByIndex(T)+L/2;for(var M=0,A=i.length;A>M;M++){x=V[i[M][0]].yAxisIndex||0,_=V[i[M][0]].xAxisIndex||0,a="horizontal"==o?this.component.yAxis.getAxis(x):this.component.xAxis.getAxis(_),p=d=f=u=a.getCoord(0);for(var E=0,z=i[M].length;z>E;E++)if(U=i[M][E],b=V[U],g=b.data[T],y=null!=g?null!=g.value?g.value:g:"-",r[U]=r[U]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0},"-"!==y){if(y>0){if(s=E>0?a.getCoordSize(y):"horizontal"==o?p-a.getCoord(y):a.getCoord(y)-p,1===z&&C[U]>s)s=C[U];if("horizontal"==o)d-=s,c=d;else h=d,d+=s}else if(0>y){if(s=E>0?a.getCoordSize(y):"horizontal"==o?a.getCoord(y)-f:f-a.getCoord(y),1===z&&C[U]>s)s=C[U];if("horizontal"==o)c=u,u+=s;else u-=s,h=u}else if(s=0,"horizontal"==o)d-=s,c=d;else h=d,d+=s;var l=Math.min(W[U]||Number.MAX_VALUE,S[U]||I);if(r[U][T]="horizontal"==o?h+l/2:c-l/2,r[U].min>y)if(r[U].min=y,"horizontal"==o)r[U].minY=c,r[U].minX=r[U][T];else r[U].minX=h+s,r[U].minY=r[U][T];if(r[U].max<y)if(r[U].max=y,"horizontal"==o)r[U].maxY=c,r[U].maxX=r[U][T];else r[U].maxX=h+s,r[U].maxY=r[U][T];if(r[U].sum+=y,r[U].counter++,T%X===0)m=this._getBarItem(U,T,v.getNameByIndex(T),h,c-("horizontal"==o?0:l),"horizontal"==o?l:s,"horizontal"==o?s:l,"horizontal"==o?"vertical":"horizontal"),this.shapeList.push(new n(m))}else;for(var E=0,z=i[M].length;z>E;E++)if(U=i[M][E],b=V[U],g=b.data[T],y=null!=g?null!=g.value?g.value:g:"-","-"==y){if(this.deepQuery([g,b,this.option],"calculable")){if("horizontal"==o)d-=this.ecTheme.island.r,c=d;else h=d,d+=this.ecTheme.island.r;l=Math.min(W[U]||Number.MAX_VALUE,S[U]||I),m=this._getBarItem(U,T,v.getNameByIndex(T),h+.5,c+.5-("horizontal"==o?0:l),("horizontal"==o?l:this.ecTheme.island.r)-1,("horizontal"==o?this.ecTheme.island.r:l)-1,"horizontal"==o?"vertical":"horizontal"),m.hoverable=!1,m.draggable=!1,m.style.lineWidth=1,m.style.brushType="stroke",m.style.strokeColor=b.calculableHolderColor||this.ecTheme.calculableHolderColor,this.shapeList.push(new n(m))}}else;"horizontal"==o?h+=l+w:c-=l+w}}this._calculMarkMapXY(r,i,"horizontal"==o?"y":"x")},_buildHorizontal:function(e,t,i,n){return this._buildNormal(e,t,i,n,"horizontal")},_buildVertical:function(e,t,i,n){return this._buildNormal(e,t,i,n,"vertical")},_buildOther:function(e,t,i,r){for(var o=this.series,a=0,s=i.length;s>a;a++)for(var l=0,h=i[a].length;h>l;l++){var c=i[a][l],d=o[c],p=d.xAxisIndex||0,u=this.component.xAxis.getAxis(p),f=u.getCoord(0),m=d.yAxisIndex||0,g=this.component.yAxis.getAxis(m),y=g.getCoord(0);r[c]=r[c]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var V=0,U=d.data.length;U>V;V++){var b=d.data[V],_=null!=b?null!=b.value?b.value:b:"-";if(_ instanceof Array){var x,v,k=u.getCoord(_[0]),L=g.getCoord(_[1]),w=[b,d],S=this.deepQuery(w,"barWidth")||10,W=this.deepQuery(w,"barHeight");if(null!=W){if(x="horizontal",_[0]>0)S=k-f,k-=S;else if(_[0]<0)S=f-k;else S=0;v=this._getBarItem(c,V,_[0],k,L-W/2,S,W,x)}else{if(x="vertical",_[1]>0)W=y-L;else if(_[1]<0)W=L-y,L-=W;else W=0;v=this._getBarItem(c,V,_[0],k-S/2,L,S,W,x)}if(this.shapeList.push(new n(v)),k=u.getCoord(_[0]),L=g.getCoord(_[1]),r[c].min0>_[0])r[c].min0=_[0],r[c].minY0=L,r[c].minX0=k;if(r[c].max0<_[0])r[c].max0=_[0],r[c].maxY0=L,r[c].maxX0=k;if(r[c].sum0+=_[0],r[c].counter0++,r[c].min1>_[1])r[c].min1=_[1],r[c].minY1=L,r[c].minX1=k;if(r[c].max1<_[1])r[c].max1=_[1],r[c].maxY1=L,r[c].maxX1=k;r[c].sum1+=_[1],r[c].counter1++}else;}}this._calculMarkMapXY(r,i,"xy")},_mapSize:function(e,t,i){var n,r,o=this._findSpecialBarSzie(t,i),a=o.barWidthMap,s=o.barMaxWidthMap,l=o.barMinHeightMap,h=o.sBarWidthCounter,c=o.sBarWidthTotal,d=o.barGap,p=o.barCategoryGap,u=1;if(t.length!=h){if(!i){if(n="string"==typeof p&&p.match(/%$/)?Math.floor(e.getGap()*(100-parseFloat(p))/100):e.getGap()-p,"string"==typeof d&&d.match(/%$/))d=parseFloat(d)/100,r=Math.floor((n-c)/((t.length-1)*d+t.length-h)),d=Math.floor(r*d);else d=parseFloat(d),r=Math.floor((n-c-d*(t.length-1))/(t.length-h));if(0>=r)return this._mapSize(e,t,!0)}else if(n=e.getGap(),d=0,r=Math.floor(n/t.length),0>=r)u=Math.floor(t.length/n),r=1}else if(n=h>1?"string"==typeof p&&p.match(/%$/)?Math.floor(e.getGap()*(100-parseFloat(p))/100):e.getGap()-p:c,r=0,d=h>1?Math.floor((n-c)/(h-1)):0,0>d)return this._mapSize(e,t,!0);return this._recheckBarMaxWidth(t,a,s,l,n,r,d,u)},_findSpecialBarSzie:function(e,t){for(var i,n,r,o,a=this.series,s={},l={},h={},c=0,d=0,p=0,u=e.length;u>p;p++)for(var f={barWidth:!1,barMaxWidth:!1},m=0,g=e[p].length;g>m;m++){var y=e[p][m],V=a[y];if(!t){if(!f.barWidth){if(i=this.query(V,"barWidth"),null!=i){s[y]=i,d+=i,c++,f.barWidth=!0;for(var U=0,b=m;b>U;U++){var _=e[p][U];s[_]=i}}}else s[y]=i;if(!f.barMaxWidth){if(n=this.query(V,"barMaxWidth"),null!=n){l[y]=n,f.barMaxWidth=!0;for(var U=0,b=m;b>U;U++){var _=e[p][U];l[_]=n}}}else l[y]=n}h[y]=this.query(V,"barMinHeight"),r=null!=r?r:this.query(V,"barGap"),o=null!=o?o:this.query(V,"barCategoryGap")}return{barWidthMap:s,barMaxWidthMap:l,barMinHeightMap:h,sBarWidth:i,sBarMaxWidth:n,sBarWidthCounter:c,sBarWidthTotal:d,barGap:r,barCategoryGap:o}},_recheckBarMaxWidth:function(e,t,i,n,r,o,a,s){for(var l=0,h=e.length;h>l;l++){var c=e[l][0];if(i[c]&&i[c]<o)r-=o-i[c]}return{barWidthMap:t,barMaxWidthMap:i,barMinHeightMap:n,gap:r,barWidth:o,barGap:a,interval:s}},_getBarItem:function(e,t,i,n,r,a,l,h){var c,d=this.series,p=d[e],u=p.data[t],f=this._sIndex2ColorMap[e],m=[u,p],g=this.deepQuery(m,"itemStyle.normal.color")||f,y=this.deepQuery(m,"itemStyle.emphasis.color"),V=this.deepMerge(m,"itemStyle.normal"),U=V.barBorderWidth,b=this.deepMerge(m,"itemStyle.emphasis");if(c={zlevel:this._zlevelBase,clickable:this.deepQuery(m,"clickable"),style:{x:n,y:r,width:a,height:l,brushType:"both",color:this.getItemStyleColor(g,e,t,u),radius:V.barBorderRadius,lineWidth:U,strokeColor:V.barBorderColor},highlightStyle:{color:this.getItemStyleColor(y,e,t,u),radius:b.barBorderRadius,lineWidth:b.barBorderWidth,strokeColor:b.barBorderColor},_orient:h},c.highlightStyle.color=c.highlightStyle.color||("string"==typeof c.style.color?s.lift(c.style.color,-.3):c.style.color),U>0&&c.style.height>U&&c.style.width>U)c.style.y+=U/2,c.style.height-=U,c.style.x+=U/2,c.style.width-=U;else c.style.brushType="fill";if(c.highlightStyle.textColor=c.highlightStyle.color,c=this.addLabel(c,p,u,i,h),"insideLeft"===c.style.textPosition||"insideRight"===c.style.textPosition||"insideTop"===c.style.textPosition||"insideBottom"===c.style.textPosition){var _=5;switch(c.style.textPosition){case"insideLeft":c.style.textX=c.style.x+_,c.style.textY=c.style.y+c.style.height/2,c.style.textAlign="left",c.style.textBaseline="middle";break;case"insideRight":c.style.textX=c.style.x+c.style.width-_,c.style.textY=c.style.y+c.style.height/2,c.style.textAlign="right",c.style.textBaseline="middle";break;case"insideTop":c.style.textX=c.style.x+c.style.width/2,c.style.textY=c.style.y+_/2,c.style.textAlign="center",c.style.textBaseline="top";break;case"insideBottom":c.style.textX=c.style.x+c.style.width/2,c.style.textY=c.style.y+c.style.height-_/2,c.style.textAlign="center",c.style.textBaseline="bottom"}c.style.textPosition="specific",c.style.textColor=c.style.textColor||"#fff"}if(this.deepQuery([u,p,this.option],"calculable"))this.setCalculable(c),c.draggable=!0;return o.pack(c,d[e],e,d[e].data[t],t,i),c},getMarkCoord:function(e,t){var i,n,r=this.series[e],o=this.xMarkMap[e],a=this.component.xAxis.getAxis(r.xAxisIndex),s=this.component.yAxis.getAxis(r.yAxisIndex);if(t.type&&("max"===t.type||"min"===t.type||"average"===t.type)){var l=null!=t.valueIndex?t.valueIndex:null!=o.maxX0?"1":"";n=[o[t.type+"X"+l],o[t.type+"Y"+l],o[t.type+"Line"+l],o[t.type+l]]}else if(o.isHorizontal){i="string"==typeof t.xAxis&&a.getIndexByName?a.getIndexByName(t.xAxis):t.xAxis||0;var h=o[i];h=null!=h?h:"string"!=typeof t.xAxis&&a.getCoordByIndex?a.getCoordByIndex(t.xAxis||0):a.getCoord(t.xAxis||0),n=[h,s.getCoord(t.yAxis||0)]}else{i="string"==typeof t.yAxis&&s.getIndexByName?s.getIndexByName(t.yAxis):t.yAxis||0;var c=o[i];c=null!=c?c:"string"!=typeof t.yAxis&&s.getCoordByIndex?s.getCoordByIndex(t.yAxis||0):s.getCoord(t.yAxis||0),n=[a.getCoord(t.xAxis||0),c]}return n},refresh:function(e){if(e)this.option=e,this.series=e.series;this.backupShapeList(),this._buildShape()},addDataAnimation:function(e){for(var t=this.series,i={},n=0,r=e.length;r>n;n++)i[e[n][0]]=e[n];for(var a,s,l,h,c,d,p,n=this.shapeList.length-1;n>=0;n--)if(d=o.get(this.shapeList[n],"seriesIndex"),i[d]&&!i[d][3])if("rectangle"===this.shapeList[n].type){if(p=o.get(this.shapeList[n],"dataIndex"),c=t[d],i[d][2]&&p===c.data.length-1){this.zr.delShape(this.shapeList[n].id);continue}else if(!i[d][2]&&0===p){this.zr.delShape(this.shapeList[n].id);continue}if("horizontal"===this.shapeList[n]._orient)h=this.component.yAxis.getAxis(c.yAxisIndex||0).getGap(),l=i[d][2]?-h:h,a=0;else s=this.component.xAxis.getAxis(c.xAxisIndex||0).getGap(),a=i[d][2]?s:-s,l=0;this.shapeList[n].position=[0,0],this.zr.animate(this.shapeList[n].id,"").when(500,{position:[a,l]}).start()}}},a.inherits(e,i),a.inherits(e,t),require("../chart").define("bar",e),e});